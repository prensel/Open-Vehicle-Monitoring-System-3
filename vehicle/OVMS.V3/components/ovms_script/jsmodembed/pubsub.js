"use strict";var messages={},lastUid=-1;function hasKeys(e){var s;for(s in e)if(e.hasOwnProperty(s))return!0;return!1}function callSubscriberWithImmediateExceptions(e,s,r){e(s,r)}function deliverMessage(e,s,r){var t,n=messages[s];if(messages.hasOwnProperty(s))for(t in n)n.hasOwnProperty(t)&&callSubscriberWithImmediateExceptions(n[t],e,r)}function createDeliveryFunction(r,t){return function(){var e=String(r),s=e.lastIndexOf(".");for(deliverMessage(r,r,t);-1!==s;)s=(e=e.substr(0,s)).lastIndexOf("."),deliverMessage(r,e,t)}}function messageHasSubscribers(e){for(var s=String(e),r=Boolean(messages.hasOwnProperty(s)&&hasKeys(messages[s])),t=s.lastIndexOf(".");!r&&-1!==t;)t=(s=s.substr(0,t)).lastIndexOf("."),r=Boolean(messages.hasOwnProperty(s)&&hasKeys(messages[s]));return r}function publish(e,s){var r=createDeliveryFunction(e="symbol"==typeof e?e.toString():e,s);return!!messageHasSubscribers(e)&&(r(),!0)}exports.publish=function(e,s){return publish(e,s)},exports.subscribe=function(e,s){if("function"!=typeof s)return!1;e="symbol"==typeof e?e.toString():e,messages.hasOwnProperty(e)||(messages[e]={});var r="uid_"+String(++lastUid);return messages[e][r]=s,r},exports.clearAllSubscriptions=function(){messages={}},exports.clearSubscriptions=function(e){var s;for(s in messages)messages.hasOwnProperty(s)&&0===s.indexOf(e)&&delete messages[s]},exports.unsubscribe=function(e){var s,r,t,n="string"==typeof e&&(messages.hasOwnProperty(e)||function(e){var s;for(s in messages)if(messages.hasOwnProperty(s)&&0===s.indexOf(e))return!0;return!1}(e)),i=!n&&"string"==typeof e,a="function"==typeof e,o=!1;if(!n){for(s in messages)if(messages.hasOwnProperty(s)){if(r=messages[s],i&&r[e]){delete r[e],o=e;break}if(a)for(t in r)r.hasOwnProperty(t)&&r[t]===e&&(delete r[t],o=!0)}return o}exports.clearSubscriptions(e)};
